<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento Automatizado - Aurin</title>
    
    <!-- CSS externo -->
    <link rel="stylesheet" href="style.css">

    <!-- **INCLUSÃO DE BIBLIOTECAS JAVASCRIPT - ORDEM CRÍTICA!** -->
    <!-- Carregamos as dependências do html2pdf.js separadamente para termos controle total sobre jsPDF -->

    <!-- 1. PDF.js: Necessário para que jsPDF e html2pdf.js possam manipular e processar arquivos PDF internos (ex: temporários) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
      // Configuração do worker para PDF.js. É essencial para que a biblioteca funcione corretamente.
      // A URL aqui aponta para a mesma versão do worker na CDN.
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    </script>

    <!-- 2. html2canvas: Biblioteca usada pelo html2pdf.js para renderizar o conteúdo HTML em uma imagem (canvas) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- 3. jsPDF: A biblioteca principal para geração de PDFs. Carregamos ela explicitamente para usar seu construtor diretamente. -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <!-- SCRIPT DE GARANTIA E DEBUG: Garante que 'jsPDF' esteja acessível globalmente -->
    <script>
        // O jsPDF UMD (Universal Module Definition) muitas vezes expõe a biblioteca sob `window.jspdf.jsPDF`
        // Esta linha garante que `jsPDF` seja globalmente acessível como `window.jsPDF`
        if (typeof window.jsPDF === 'undefined' && typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined') {
            window.jsPDF = window.jspdf.jsPDF;
        }

        console.log("--- DEBUG DE JSPDF APÓS GARANTIA GLOBAL ---");
        console.log("typeof jsPDF (global):", typeof jsPDF);
        console.log("typeof window.jsPDF (global):", typeof window.jsPDF);
        if (typeof window.jsPDF === 'function') {
            console.log('jsPDF (v2.5.1) ESTÁ AGORA DEFINIDO GLOBALMENTE E ACESSÍVEL.');
        } else {
            console.error('CRÍTICO: jsPDF (v2.5.1) AINDA NÃO ESTÁ DEFINIDO GLOBALMENTE. Verifique extensões do navegador ou ambiente.');
            console.error('Se este erro persistir, o problema está em como seu navegador/ambiente executa scripts de CDN.');
        }
        console.log("------------------------------------------------");
    </script>

    <!-- 4. html2pdf.js: A biblioteca que orquestra a conversão de HTML para PDF, utilizando html2canvas e jsPDF. -->
    <!-- Importante: Esta é a versão 'não-bundle', que espera que html2canvas e jsPDF já estejam carregados. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.min.js"></script>
    
    <!-- SEU SCRIPT PERSONALIZADO: Deve ser o último a ser carregado, pois depende de todas as bibliotecas acima. -->
    <!-- O atributo 'defer' garante que seu script será executado após o HTML ser completamente parseado. -->
    <script src="script.js" defer></script>
</head>
<body>
    <div id="toast-container" class="toast-container"></div>
    <header>
        <div class="container">
            <img id="aurin-logo-img" src="logo-aurin.png" alt="Aurin Logo" class="logo">
            <h1>Sistema de Orçamentos Automatizados</h1>
            <p>Arquitetura e Modelagem 3D sobre Nuvem de Pontos</p>
            <a href="configuracoes.html" style="color: white; text-decoration: none; margin-left: 20px;">
                <button style="background-color: #555; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                    ⚙️ Configurações
                </button>
            </a>
        </div>
    </header>
    
    <div class="container">
        <div class="form-container">
            <h2>Dados do Cliente</h2>
            <div class="form-group">
                <label for="client-name" class="required-field">Nome do Cliente</label>
                <input type="text" id="client-name" placeholder="Digite o nome completo">
                <div class="error-message" id="client-name-error">Por favor, informe o nome do cliente.</div>
            </div>
            <div class="form-group">
                <label for="client-email" class="required-field">E-mail</label>
                <input type="email" id="client-email" placeholder="email@exemplo.com">
                <div class="error-message" id="client-email-error">Por favor, informe um e-mail válido.</div>
            </div>
            <div class="form-group">
                <label for="client-phone">Telefone</label>
                <input type="tel" id="client-phone" placeholder="(00) 00000-0000">
            </div>
            <h2>Informações do Projeto</h2>
            <div class="form-group">
                <label for="building-type" class="required-field">Tipo de Edificação</label>
                <select id="building-type">
                    <option value="">Selecione o tipo de edificação</option>
                    <option value="comercial">Edificação Comercial</option>
                    <option value="industrial">Edificação Industrial</option>
                    <option value="residencial">Edificação Residencial</option>
                    <option value="externa">Edificação Externa (terrenos)</option>
                    <option value="restauracao">Edificação de Restauração (as Built)</option>
                </select>
                <div class="error-message" id="building-type-error">Por favor, selecione o tipo de edificação.</div>
            </div>
            
            <div class="form-group">
                <label for="square-meters" class="required-field">Metragem Quadrada (m²)</label>
                <input type="number" id="square-meters" min="1" placeholder="Digite a metragem do projeto">
                <div class="error-message" id="square-meters-error">Por favor, informe uma metragem válida maior que zero.</div>
            </div>
            
            <div class="form-group">
                <label for="difficulty">Nível de Dificuldade</label>
                <select id="difficulty">
                    <option value="0">Selecione o nível de dificuldade</option>
                    <option value="1">Nível 01 (+10%)</option>
                    <option value="2">Nível 02 (+20%)</option>
                    <option value="3">Nível 03 (+30%)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Disciplinas que a modelagem deve conter</label>
                <div class="selection-group">
                    <label class="selection-item">
                        <input type="checkbox" id="arch-modeling" checked>
                        <div class="selection-content">
                            <h4>Modelagem Arquitetônica</h4>
                            <p>Detalhes de paredes, portas, janelas, lajes, telhados e acabamentos.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="struct-modeling">
                        <div class="selection-content">
                            <h4>Modelagem Estrutural</h4>
                            <p>Representa pilares, vigas, lajes e fundações para análise e compatibilização.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="elec-modeling">
                        <div class="selection-content">
                            <h4>Modelagem Elétrica</h4>
                            <p>Abrange circuitos, iluminação, tomadas, painéis e eletrodutos.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="hydro-modeling">
                        <div class="selection-content">
                            <h4>Modelagem Hidráulica</h4>
                            <p>Detalha instalações de água fria, quente, esgoto sanitário e pluviais.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="pipe-modeling">
                        <div class="selection-content">
                            <h4>Modelagem de Tubulações</h4>
                            <p>Representa redes complexas de tubulações para diversas finalidades.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="mach-modeling">
                        <div class="selection-content">
                            <h4>Modelagem de Maquinários</h4>
                            <p>Cria modelos 3D precisos de equipamentos industriais e componentes.</p>
                        </div>
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label>Entregáveis</label>
                <div class="selection-group">
                    <label class="selection-item">
                        <input type="checkbox" id="revit24" checked>
                        <div class="selection-content">
                            <h4>Modelagem 3D Revit versão 24</h4>
                            <p>Arquivo de modelo 3D compatível com a versão 2024 do Revit.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="revit23">
                        <div class="selection-content">
                            <h4>Modelagem 3D Revit versão 23</h4>
                            <p>Arquivo de modelo 3D compatível com a versão 2023 do Revit.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="revit22">
                        <div class="selection-content">
                            <h4>Modelagem 3D Revit versão 22</h4>
                            <p>Arquivo de modelo 3D compatível com a versão 2022 do Revit.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="pdf">
                        <div class="selection-content">
                            <h4>Arquivo PDF</h4>
                            <p>Documentação do projeto em formato PDF.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="dwg2d">
                        <div class="selection-content">
                            <h4>DWG 2D</h4>
                            <p>Desenhos técnicos bidimensionais em formato DWG.</p>
                        </div>
                    </label>
                    <label class="selection-item">
                        <input type="checkbox" id="dwg3d">
                        <div class="selection-content">
                            <h4>DWG 3D</h4>
                            <p>Modelo tridimensional em formato DWG.</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="discount">Desconto (%)</label>
                <input type="number" id="discount" min="0" max="100" placeholder="0">
            </div>
            <div class="form-group">
                <label class="required-field">Nível de Detalhe da Modelagem (LOD)</label>
                <div class="lod-group">
                    <label class="lod-item">
                        <input type="radio" name="lod-level" value="lod200" checked>
                        <div class="lod-content">
                            <h4>LOD 200: Geometria Genérica</h4>
                            <p>Representação volumétrica ou área de superfície aproximada. Detalhes simbólicos ou genéricos, sem especificações de montagem ou fabricação. Ideal para estudos preliminares e análise de massa.</p>
                        </div>
                    </label>
                    <label class="lod-item">
                        <input type="radio" name="lod-level" value="lod300">
                        <div class="lod-content">
                            <h4>LOD 300: Geometria Precisa</h4>
                            <p>Representação precisa de quantidades, tamanho, forma, localização e orientação. Componentes específicos com informações de fabricação e instalação. Usado para coordenação, quantificação e documentação de construção.</p>
                        </div>
                    </label>
                    <label class="lod-item">
                        <input type="radio" name="lod-level" value="lod400">
                        <div class="lod-content">
                            <h4>LOD 400: Geometria para Fabricação</h4>
                            <p>Representação com detalhes de fabricação, montagem e informações precisas para construção. Inclui detalhes específicos para instalação e montagem de componentes. Ideal para detalhamento executivo e fabricação.</p>
                        </div>
                    </label>
                </div>
                <div class="error-message" id="lod-level-error">Por favor, selecione o nível de detalhe (LOD).</div>
            </div>
            
            <button type="button" id="calculate-btn">Calcular Orçamento</button>
        </div>

        <div class="form-container" id="history-container">
            <h2>Histórico de Orçamentos</h2>
            <div id="history-list">
                <p>Nenhum orçamento salvo ainda.</p>
            </div>
            <button type="button" class="clear-history-btn" style="margin-top: 20px;">Limpar Histórico</button>
        </div>
        
        <div class="result-container" id="result-container">
            <div class="result-header">
                <h2>Orçamento - Aurin</h2>
                <p><strong>Data do orçamento:</strong> <span id="quote-date"></span></p>
                <p><strong>Validade:</strong> 30 dias</p>
            </div>
            
            <div class="result-section">
                <h3>Informações do Cliente</h3>
                <p><strong>Nome:</strong> <span id="result-name"></span></p>
                <p><strong>E-mail:</strong> <span id="result-email"></span></p>
                <p><strong>Telefone:</strong> <span id="result-phone"></span></p>
            </div>
            
            <div class="result-section">
                <h3>Detalhes do Projeto</h3>
                <p><strong>Tipo de Edificação:</strong> <span id="result-building-type"></span></p>
                <p><strong>Metragem Quadrada:</strong> <span id="result-square-meters"></span> m²</p>
                <p><strong>Nível de Dificuldade:</strong> <span id="result-difficulty"></span></p>
            </div>
            
            <div class="result-section">
                <h3>Disciplinas Incluídas</h3>
                <ul id="result-disciplines"></ul>
            </div>
            
            <div class="result-section">
                <h3>Entregáveis</h3>
                <ul id="result-deliverables"></ul>
            </div>
            
            <div class="result-section">
                <h3>Nível de Detalhe (LOD)</h3>
                <p><strong>Nível Selecionado:</strong> <span id="result-lod-level"></span></p>
                <p><small id="result-lod-description"></small></p>
            </div>
            
            <!-- Seções para preenchimento dinâmico na geração do PDF -->
            <div class="result-section" id="disciplines-detail-section" style="display:none;"></div>
            <div class="result-section" id="terms-conditions-section" style="display:none;"></div>
            
            <div class="result-section" id="financial-summary-section">
                <h3>Resumo Financeiro</h3>
                <table>
                    <tr>
                        <th>Item</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Valor Base</td>
                        <td id="base-value">R$ 0,00</td>
                    </tr>
                    <tr>
                        <td>Adicional por Nível de Dificuldade</td>
                        <td id="difficulty-value">R$ 0,00</td>
                    </tr>
                    <tr>
                        <td>Adicional por Disciplinas</td>
                        <td id="discipline-additional-value">R$ 0,00</td>
                    </tr>
                    <tr>
                        <td>Adicional por LOD</td>
                        <td id="lod-additional-value">R$ 0,00</td>
                    </tr>
                    <tr>
                        <td>Desconto</td>
                        <td id="discount-value">R$ 0,00</td>
                    </tr>
                    <tr class="total-row">
                        <td>Valor Total</td>
                        <td id="total-value">R$ 0,00</td>
                    </tr>
                </table>
            </div>
            
            <div class="result-section">
                <h3>Cronograma Estimado</h3>
                <p><strong>Horas de Modelagem:</strong> <span id="modeling-hours"></span> horas</p>
                <p><strong>Dias de Trabalho:</strong> <span id="working-days"></span> dias</p>
                <p><small>Considerando 8 horas de trabalho por dia</small></p>
            </div>
            
            <div class="form-group button-group">
                <button type="button" class="print-btn" onclick="window.print()">Imprimir Orçamento</button>
                <button type="button" class="pdf-btn" id="generate-pdf-btn">Gerar PDF</button>
                <button type="button" class="email-btn" id="send-email-btn">Enviar por E-mail</button>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay for PDF Generation -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Gerando PDF...</p>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 Aurin - Arquitetura e Modelagem 3D sobre Nuvem de Pontos</p>
            <p>Todos os direitos reservados</p>
        </div>
    </footer>
</body>
</html>